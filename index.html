<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lucknow Wala | Zero-Load System</title>
    
    <!-- Custom Favicon (Updated to Rust) -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%23C04000'/><text x='50' y='72' font-family='serif' font-size='65' font-weight='bold' fill='white' text-anchor='middle'>L</text></svg>">

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    
    <!-- Fonts: Rozha One (Display) & Lato (UI) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&family=Rozha+One&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0" />

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        /* --- BRAND SYSTEM v0.3.1 --- */
                        'brand': {
                            primary: '#C04000',  /* Zaika Rust */
                            dark:    '#8A2D00',  /* Deep Interaction */
                            tint:    '#FFF5F0',  /* Subtle Backgrounds */
                        },
                        'surface': {
                            cream:   '#F9F9F4',  /* Page BG */
                            white:   '#FFFFFF',  /* Card BG */
                            input:   '#F0F0EB',  /* Input BG */
                        },
                        'text': {
                            main:    '#1A1A1A',  /* Soft Black */
                            muted:   '#595959',  /* Dark Gray */
                            light:   '#9CA3AF',  /* Labels */
                        },
                        'border': {
                            light:   '#E6E6E6',
                            focus:   '#C04000',
                        },
                        'status': {
                            success: '#15803D',
                            bg:      '#DCFCE7',
                        }
                    },
                    fontFamily: {
                        'display': ['"Rozha One"', 'serif'],
                        'body':    ['"Lato"', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft':   '0 1px 2px rgba(0,0,0,0.04)',
                        'card':   '0 4px 12px rgba(0,0,0,0.06)',
                        'float':  '0 12px 24px -4px rgba(0,0,0,0.08)',
                        'brand':  '0 4px 12px rgba(192, 64, 0, 0.25)',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.4s cubic-bezier(0.2, 0.8, 0.2, 1) forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            from: { opacity: '0', transform: 'translateY(8px)' },
                            to: { opacity: '1', transform: 'translateY(0)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Utilities */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        body { -webkit-tap-highlight-color: transparent; }
        html { scroll-behavior: smooth; }
        
        .skeleton { background: #f0f0f0; position: absolute; inset: 0; z-index: 0; }
        .img-fade-in { opacity: 0; transition: opacity 0.4s ease-in; }
        .img-loaded { opacity: 1; }
    </style>
</head>
<body class="bg-surface-cream text-text-main font-body min-h-screen pb-32 selection:bg-brand-primary/20 selection:text-brand-primary">

    <!-- HEADER: Heritage & Clean -->
    <div class="sticky top-0 z-30 pt-6 pb-2 bg-surface-cream/95 backdrop-blur-md border-b border-border-light transition-all duration-300">
        
        <div class="text-center mb-6 px-4">
            <!-- H1: Brand Moment (Rozha One) -->
            <h1 class="font-display text-[2.75rem] text-brand-primary leading-none mb-1 tracking-tight">Lucknow Wala</h1>
            <!-- Subtitle: Functional (Lato) -->
            <p class="text-xs font-bold text-text-muted uppercase tracking-[0.1em]">100% Pure Veg • Authentic Taste</p>
        </div>
        
        <div class="px-5 pb-4 w-full flex justify-center">
            <div class="w-full max-w-lg relative z-20 flex gap-3 items-center">
                
                <!-- Search: Input Surface (Lato) -->
                <div class="relative group flex-grow">
                    <span class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-text-light text-[20px] group-focus-within:text-brand-primary transition-colors">search</span>
                    
                    <input type="text" 
                        id="search-input"
                        placeholder="Search for kebabs, rolls..." 
                        class="w-full h-[50px] pl-11 pr-12 rounded-xl bg-surface-input border border-transparent text-base font-medium text-text-main placeholder-text-light focus:bg-surface-white focus:border-brand-primary focus:ring-4 focus:ring-brand-primary/10 transition-all outline-none shadow-sm"
                        oninput="handleSearch(this.value)">
                    
                    <button onclick="toggleFilterModal()" class="absolute right-2 top-1/2 -translate-y-1/2 w-9 h-9 rounded-lg bg-surface-white border border-border-light flex items-center justify-center text-text-main hover:border-brand-primary hover:text-brand-primary transition-all active:scale-95 shadow-sm">
                        <span class="material-symbols-outlined text-[18px]">tune</span>
                        <span id="filter-indicator" class="absolute top-1.5 right-1.5 w-1.5 h-1.5 bg-brand-primary rounded-full hidden"></span>
                    </button>
                </div>

            </div>
        </div>

        <nav class="bg-transparent">
            <div class="max-w-7xl mx-auto">
                <!-- Added padding to avoid clipping shadows -->
                <div class="flex gap-3 overflow-x-auto hide-scrollbar px-5 py-2" id="category-container">
                    <!-- Categories injected here -->
                </div>
            </div>
        </nav>
    </div>

    <!-- MENU GRID -->
    <main class="max-w-7xl mx-auto px-5 py-8">
        <div id="menu-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Items injected here -->
        </div>

        <div id="empty-state" class="hidden flex-col items-center justify-center py-20 text-center">
            <span class="material-symbols-outlined text-5xl text-gray-300 mb-4">no_meals</span>
            <p class="text-text-muted font-medium text-base">No dishes found matching your search.</p>
            <button onclick="clearSearchAndFilters()" class="mt-4 text-brand-primary font-bold underline decoration-2 underline-offset-4">Reset Menu</button>
        </div>
    </main>

    <!-- FLOATING CART BAR (Pill Shape) -->
    <div id="cart-bar" class="fixed bottom-8 left-5 right-5 z-40 transform translate-y-[150%] transition-transform duration-500 cubic-bezier(0.2, 0.8, 0.2, 1) md:left-1/2 md:-translate-x-1/2 md:max-w-md">
        <div onclick="toggleCartModal()" class="bg-brand-primary text-white p-2 pl-6 pr-2 rounded-full shadow-brand flex items-center justify-between cursor-pointer hover:bg-brand-dark transition-colors duration-300">
            
            <div class="flex flex-col">
                <span class="text-[10px] font-bold text-white/80 uppercase tracking-wider mb-0.5">Total</span>
                <span id="cart-bar-total" class="font-body font-black text-xl leading-none">₹0</span>
            </div>

            <div class="bg-white text-brand-primary px-6 py-3 rounded-full font-bold text-sm flex items-center gap-2 shadow-sm group">
                <span>View Cart</span>
                <span class="material-symbols-outlined text-[18px] group-hover:translate-x-1 transition-transform">arrow_forward</span>
            </div>
        </div>
    </div>

    <!-- CART MODAL -->
    <div id="cart-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-text-main/20 backdrop-blur-sm transition-opacity opacity-0" id="cart-backdrop" onclick="toggleCartModal()"></div>
        
        <div class="absolute bottom-0 left-0 right-0 bg-surface-white rounded-t-[2rem] md:rounded-[2rem] md:bottom-auto md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 md:w-full md:max-w-md shadow-float transform translate-y-full md:translate-y-10 transition-transform duration-300 flex flex-col max-h-[90vh]" id="cart-content">
            
            <!-- Header -->
            <div class="px-8 py-6 border-b border-border-light flex items-center justify-between bg-surface-white rounded-t-[2rem] z-10 shrink-0">
                <div>
                    <!-- H2 Brand Moment -->
                    <h2 class="font-display text-2xl text-brand-primary tracking-tight">Your Order</h2>
                    <div id="cart-mode-subtitle" class="flex items-center gap-1.5 mt-1 text-text-muted hidden">
                        <span id="cart-mode-icon" class="material-symbols-outlined text-[16px]"></span>
                        <span id="cart-mode-text" class="uppercase tracking-wide font-bold text-[10px]"></span>
                    </div>
                </div>
                <button onclick="toggleCartModal()" class="w-10 h-10 rounded-full bg-surface-input flex items-center justify-center hover:bg-border-light text-text-muted transition-colors">
                    <span class="material-symbols-outlined text-[20px]">close</span>
                </button>
            </div>

            <!-- Items -->
            <div class="overflow-y-auto p-6 flex-1 custom-scrollbar" id="cart-items-container">
                <!-- JS Injected -->
            </div>

            <!-- Footer -->
            <div class="p-6 bg-surface-white border-t border-border-light rounded-b-[2rem] shadow-[0_-4px_20px_rgba(0,0,0,0.02)] z-20 shrink-0">
                
                <div class="flex justify-between items-center mb-6">
                    <span class="text-sm font-bold text-text-muted">Total Amount</span>
                    <span id="modal-total" class="font-body font-black text-3xl text-brand-primary">₹0</span>
                </div>

                <div class="space-y-4 mb-6">
                    <input type="text" id="cust-name" placeholder="Your Name" class="w-full px-5 py-3.5 rounded-xl bg-surface-input border border-transparent text-base font-medium outline-none focus:bg-surface-white focus:border-brand-primary focus:ring-1 focus:ring-brand-primary transition-all placeholder-text-light">
                    
                    <div id="phone-container" class="relative group">
                        <div class="absolute left-5 top-1/2 -translate-y-1/2 text-text-muted font-bold text-sm border-r border-gray-300 pr-3 h-5 flex items-center pointer-events-none select-none">
                            +91
                        </div>
                        <input type="tel" 
                               id="cust-phone" 
                               placeholder="Phone Number" 
                               maxlength="10"
                               inputmode="numeric"
                               oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 10)"
                               class="w-full pl-[4.5rem] pr-5 py-3.5 rounded-xl bg-surface-input border border-transparent text-base font-bold text-text-main outline-none focus:bg-surface-white focus:border-brand-primary focus:ring-1 focus:ring-brand-primary transition-all placeholder-text-light">
                    </div>
                    
                    <div id="address-container" class="hidden animate-fade-in">
                        <input type="text" id="cust-address" placeholder="Delivery Address" class="w-full px-5 py-3.5 rounded-xl bg-surface-input border border-transparent text-base font-medium outline-none focus:bg-surface-white focus:border-brand-primary focus:ring-1 focus:ring-brand-primary transition-all placeholder-text-light">
                    </div>
                </div>

                <button onclick="placeOrder()" class="w-full py-4 bg-status-success hover:bg-green-700 text-white rounded-full font-body font-bold text-lg tracking-wide shadow-lg shadow-green-600/20 flex items-center justify-center gap-2 transition-transform active:scale-[0.98]">
                    <span>Place Order</span>
                    <svg class="w-5 h-5 fill-current" viewBox="0 0 448 512"><path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7 .9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"></path></svg>
                </button>
            </div>
        </div>
    </div>

    <!-- FILTER MODAL -->
    <div id="filter-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-text-main/20 backdrop-blur-sm transition-opacity opacity-0" id="filter-backdrop" onclick="toggleFilterModal()"></div>
        
        <div class="absolute bottom-0 left-0 right-0 bg-surface-white rounded-t-[2rem] md:rounded-[2rem] md:bottom-auto md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 md:w-full md:max-w-sm shadow-float transform translate-y-full md:translate-y-10 transition-transform duration-300 flex flex-col" id="filter-content">
            
            <div class="p-6 border-b border-border-light flex items-center justify-between">
                <h3 class="font-display text-xl text-brand-primary tracking-tight">Filter & Sort</h3>
                <button onclick="toggleFilterModal()" class="w-9 h-9 rounded-full bg-surface-input flex items-center justify-center hover:bg-border-light text-text-muted transition-colors">
                    <span class="material-symbols-outlined text-lg">close</span>
                </button>
            </div>

            <div class="p-6 space-y-8">
                <!-- Dietary -->
                <div>
                    <h4 class="text-xs font-black text-text-light uppercase tracking-widest mb-4 font-body">Dietary</h4>
                    <label class="flex items-center gap-3 cursor-pointer group">
                        <div class="relative">
                            <input type="checkbox" id="filter-veg" class="sr-only peer" onchange="updatePendingFilter('veg', this.checked)">
                            <div class="w-11 h-6 bg-surface-input border border-border-light rounded-full peer-checked:bg-status-success peer-checked:border-status-success transition-colors"></div>
                            <div class="absolute top-1 left-1 bg-white w-4 h-4 rounded-full transition-transform peer-checked:translate-x-5 shadow-sm"></div>
                        </div>
                        <span class="font-bold text-text-main text-sm group-hover:text-brand-primary transition-colors">Pure Veg Only</span>
                    </label>
                </div>

                <!-- Price Range -->
                <div>
                    <h4 class="text-xs font-black text-text-light uppercase tracking-widest mb-4 font-body">Price Range</h4>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="updatePendingFilter('price', 'all')" id="btn-price-all" class="filter-chip">Any</button>
                        <button onclick="updatePendingFilter('price', 'low')" id="btn-price-low" class="filter-chip">Under ₹50</button>
                        <button onclick="updatePendingFilter('price', 'mid')" id="btn-price-mid" class="filter-chip">₹50 - ₹100</button>
                        <button onclick="updatePendingFilter('price', 'high')" id="btn-price-high" class="filter-chip">Above ₹100</button>
                    </div>
                </div>

                <!-- Sort -->
                <div>
                    <h4 class="text-xs font-black text-text-light uppercase tracking-widest mb-4 font-body">Sort By</h4>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="updatePendingFilter('sort', 'default')" id="btn-sort-default" class="filter-chip">Recommended</button>
                        <button onclick="updatePendingFilter('sort', 'asc')" id="btn-sort-asc" class="filter-chip">Price: Low to High</button>
                        <button onclick="updatePendingFilter('sort', 'desc')" id="btn-sort-desc" class="filter-chip">Price: High to Low</button>
                    </div>
                </div>
            </div>

            <div class="p-5 border-t border-border-light flex gap-4 bg-surface-cream rounded-b-[2rem]">
                <button onclick="clearFilters()" class="flex-1 py-3.5 text-text-main font-bold hover:bg-border-light rounded-full transition-colors bg-white border border-border-light">Clear</button>
                <button onclick="applyFilters()" class="flex-[2] py-3.5 bg-brand-primary text-white font-bold rounded-full shadow-brand active:scale-[0.98] transition-transform text-lg">Apply Filters</button>
            </div>
        </div>
    </div>

    <!-- MODE SELECTOR MODAL -->
    <div id="mode-selector" class="fixed inset-0 z-[60] bg-text-main/40 backdrop-blur-md hidden flex items-center justify-center p-5">
        <div class="bg-surface-white rounded-[2rem] p-8 w-full max-w-sm text-center animate-fade-in shadow-float relative overflow-hidden border border-border-light">
            
            <div class="relative z-10">
                <h3 class="font-display text-3xl text-brand-primary mb-2">Order Type</h3>
                <p class="text-text-muted text-sm mb-8 font-medium">How would you like to receive your food?</p>
                
                <div class="space-y-3">
                    <!-- Delivery -->
                    <button onclick="selectMode('Delivery')" class="w-full group relative flex items-center p-4 rounded-xl border border-border-light bg-surface-cream hover:bg-white hover:border-brand-primary hover:shadow-card transition-all duration-200">
                        <div class="w-10 h-10 rounded-full bg-white text-text-main shadow-sm flex items-center justify-center shrink-0 group-hover:bg-brand-primary group-hover:text-white transition-colors">
                            <span class="material-symbols-outlined text-[20px]">two_wheeler</span>
                        </div>
                        <div class="ml-4 text-left">
                            <span class="block font-bold text-lg text-text-main group-hover:text-brand-primary transition-colors">Delivery</span>
                            <span class="block text-xs font-bold text-text-light uppercase tracking-wide">Doorstep delivery</span>
                        </div>
                    </button>

                    <!-- Pickup -->
                    <button onclick="selectMode('Pickup')" class="w-full group relative flex items-center p-4 rounded-xl border border-border-light bg-surface-cream hover:bg-white hover:border-brand-primary hover:shadow-card transition-all duration-200">
                        <div class="w-10 h-10 rounded-full bg-white text-text-main shadow-sm flex items-center justify-center shrink-0 group-hover:bg-brand-primary group-hover:text-white transition-colors">
                            <span class="material-symbols-outlined text-[20px]">shopping_bag</span>
                        </div>
                        <div class="ml-4 text-left">
                            <span class="block font-bold text-lg text-text-main group-hover:text-brand-primary transition-colors">Pickup</span>
                            <span class="block text-xs font-bold text-text-light uppercase tracking-wide">Takeaway from store</span>
                        </div>
                    </button>

                    <!-- Dine-in -->
                    <button onclick="selectMode('Dine-in')" class="w-full group relative flex items-center p-4 rounded-xl border border-border-light bg-surface-cream hover:bg-white hover:border-brand-primary hover:shadow-card transition-all duration-200">
                        <div class="w-10 h-10 rounded-full bg-white text-text-main shadow-sm flex items-center justify-center shrink-0 group-hover:bg-brand-primary group-hover:text-white transition-colors">
                            <span class="material-symbols-outlined text-[20px]">restaurant</span>
                        </div>
                        <div class="ml-4 text-left">
                            <span class="block font-bold text-lg text-text-main group-hover:text-brand-primary transition-colors">Dine-in</span>
                            <span class="block text-xs font-bold text-text-light uppercase tracking-wide">Eat at the restaurant</span>
                        </div>
                    </button>
                </div>

                <button onclick="document.getElementById('mode-selector').classList.add('hidden')" class="mt-8 text-xs font-black text-text-tertiary hover:text-text-main transition-colors tracking-widest uppercase">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // System UI Override for alert()
        window.alert = function(msg) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-6 left-1/2 -translate-x-1/2 bg-text-main text-white px-6 py-3 rounded-full shadow-float z-[100] font-bold text-sm transition-all duration-300 transform -translate-y-full opacity-0 pointer-events-none border border-gray-700 flex items-center gap-2';
            toast.innerHTML = `<span class="material-symbols-outlined text-sm">info</span><span>${msg}</span>`;
            document.body.appendChild(toast);
            requestAnimationFrame(() => toast.classList.remove('-translate-y-full', 'opacity-0'));
            setTimeout(() => {
                toast.classList.add('-translate-y-full', 'opacity-0');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        };

        // --- DATASET ---
        const CAT_IMG_ALL = 'https://placehold.co/100x100/C04000/FFF?text=All';
        const CAT_IMG_ROLLS = 'https://placehold.co/100x100/1A1A1A/FFF?text=Rolls';
        const CAT_IMG_VEG_PLATE = 'https://placehold.co/100x100/1A1A1A/FFF?text=Veg+Plate';
        const CAT_IMG_PANEER_PLATE = 'https://placehold.co/100x100/1A1A1A/FFF?text=Paneer+Plate';
        const CAT_IMG_ROTI = 'https://placehold.co/100x100/1A1A1A/FFF?text=Paratha';
        const CAT_IMG_SPECIAL = 'https://placehold.co/100x100/1A1A1A/FFF?text=Special';
        const CAT_IMG_BIRYANI = 'https://placehold.co/100x100/1A1A1A/FFF?text=Biryani';

        const CATEGORIES = [
            { id: 'all', label: 'All', img: CAT_IMG_ALL },
            { id: 'rolls', label: 'Rolls', img: CAT_IMG_ROLLS },
            { id: 'veg_kabab_paratha_plate', label: 'Veg Kabab Paratha Plate', img: CAT_IMG_VEG_PLATE },
            { id: 'paneer_kabab_paratha_plate', label: 'Paneer Kabab Paratha Plate', img: CAT_IMG_PANEER_PLATE },
            { id: 'only_paratha', label: 'Only Paratha', img: CAT_IMG_ROTI },
            { id: 'special_paratha', label: 'Special Paratha', img: CAT_IMG_SPECIAL },
            { id: 'veg_biryani', label: 'Veg Biryani', img: CAT_IMG_BIRYANI },
        ];

        // Using placeholder images that match the Cream/Rust aesthetic
        const IMG_ROLL = 'https://placehold.co/500x500/F0F0EB/C04000?text=%20';
        const IMG_KABAB = 'https://placehold.co/500x500/F0F0EB/C04000?text=%20';
        const IMG_PANEER = 'https://placehold.co/500x500/F0F0EB/C04000?text=%20';
        const IMG_PARATHA = 'https://placehold.co/500x500/F0F0EB/C04000?text=%20';
        const IMG_SPECIAL = 'https://placehold.co/500x500/F0F0EB/C04000?text=%20';
        const IMG_BIRYANI = 'https://placehold.co/500x500/F0F0EB/C04000?text=%20';

        const MENU_ITEMS = [
            // Rolls
            { id: 'roll1', name: 'Veg Kabab Roll', price: 30, cat: 'rolls', img: IMG_ROLL, veg: true },
            { id: 'roll2', name: 'Paneer Kabab Roll', price: 40, cat: 'rolls', img: IMG_ROLL, veg: true },
            
            // Veg Kabab Paratha Plate
            { id: 'vkp1', name: '1 Kabab + 1 Paratha', price: 30, cat: 'veg_kabab_paratha_plate', img: IMG_KABAB, veg: true },
            { id: 'vkp2', name: '1 Kabab + 2 Paratha', price: 45, cat: 'veg_kabab_paratha_plate', img: IMG_KABAB, veg: true },
            { id: 'vkp3', name: '2 Kabab + 2 Paratha', price: 60, cat: 'veg_kabab_paratha_plate', img: IMG_KABAB, veg: true },
            
            // Paneer Kabab Paratha Plate
            { id: 'pkp1', name: '1 Paneer Kabab + 1 Paratha', price: 40, cat: 'paneer_kabab_paratha_plate', img: IMG_PANEER, veg: true },
            { id: 'pkp2', name: '1 Paneer Kabab + 2 Paratha', price: 55, cat: 'paneer_kabab_paratha_plate', img: IMG_PANEER, veg: true },
            { id: 'pkp3', name: '2 Paneer Kabab + 2 Paratha', price: 80, cat: 'paneer_kabab_paratha_plate', img: IMG_PANEER, veg: true },
            
            // Only Paratha
            { id: 'op1', name: 'Single Paratha (Normal)', price: 15, cat: 'only_paratha', img: IMG_PARATHA, veg: true },
            
            // Special Paratha
            { id: 'sp1', name: 'Ghee Paratha', price: 20, cat: 'special_paratha', img: IMG_SPECIAL, veg: true },
            { id: 'sp2', name: 'Butter Paratha', price: 20, cat: 'special_paratha', img: IMG_SPECIAL, veg: true },
            
            // Veg Biryani
            { id: 'vb1', name: 'Veg Biryani (Quarter)', price: 30, cat: 'veg_biryani', img: IMG_BIRYANI, veg: true },
            { id: 'vb2', name: 'Veg Biryani (Half)', price: 60, cat: 'veg_biryani', img: IMG_BIRYANI, veg: true },
            { id: 'vb3', name: 'Veg Biryani (Full)', price: 120, cat: 'veg_biryani', img: IMG_BIRYANI, veg: true },
        ];

        // --- STATE ---
        let currentCat = 'all';
        let searchQuery = '';
        let cart = {}; 
        let currentMode = null; 
        const modeConfig = {
            'Delivery': { icon: 'two_wheeler' },
            'Pickup': { icon: 'shopping_bag' },
            'Dine-in': { icon: 'restaurant' }
        };

        let activeFilters = { veg: false, price: 'all', sort: 'default' };
        let pendingFilters = { ...activeFilters };

        document.addEventListener('DOMContentLoaded', () => {
            renderCategories();
            renderMenu();
        });

        // --- RENDERERS ---
        function renderCategories() {
            const container = document.getElementById('category-container');
            container.innerHTML = CATEGORIES.map(cat => `
                <button onclick="setCategory('${cat.id}')" 
                    class="group flex items-center gap-2 px-1.5 py-1.5 pr-4 rounded-full transition-all border shrink-0 outline-none
                    ${currentCat === cat.id 
                        ? 'bg-brand-primary text-white border-brand-primary shadow-brand scale-[1.02]' 
                        : 'bg-surface-white text-text-main border-transparent hover:border-border-light shadow-soft'}">
                    <div class="w-8 h-8 rounded-full overflow-hidden bg-surface-input shrink-0">
                        <img src="${cat.img}" class="w-full h-full object-cover opacity-90 group-hover:opacity-100" alt="${cat.label}">
                    </div>
                    <span class="font-bold text-sm tracking-wide leading-none">${cat.label}</span>
                </button>
            `).join('');
        }

        function getCardActionHTML(item) {
            const itemTotal = getQuantity(item.id);
            if (itemTotal === 0) {
                return `<button onclick="triggerAdd('${item.id}')" class="px-5 py-2.5 rounded-full bg-brand-primary text-white text-sm font-bold hover:bg-brand-dark transition-all shadow-brand active:scale-95">
                    ADD
                </button>`;
            } else {
                return `<div class="flex items-center bg-brand-primary text-white rounded-full h-[38px] px-1 shadow-brand">
                    <button onclick="updateCart('${item.id}', -1)" class="w-9 h-full flex items-center justify-center font-bold text-lg active:scale-90">-</button>
                    <span class="text-sm font-black w-4 text-center">${itemTotal}</span>
                    <button onclick="updateCart('${item.id}', 1)" class="w-9 h-full flex items-center justify-center font-bold text-lg active:scale-90">+</button>
                </div>`;
            }
        }

        function renderMenu() {
            const grid = document.getElementById('menu-grid');
            const empty = document.getElementById('empty-state');
            
            let items = MENU_ITEMS;

            if (currentCat !== 'all') items = items.filter(item => item.cat === currentCat);
            if (searchQuery) {
                const q = searchQuery.toLowerCase();
                items = items.filter(item => item.name.toLowerCase().includes(q) || item.cat.toLowerCase().includes(q));
            }
            if (activeFilters.veg) items = items.filter(item => item.veg === true);
            if (activeFilters.price !== 'all') {
                items = items.filter(item => {
                    if (activeFilters.price === 'low') return item.price < 50;
                    if (activeFilters.price === 'mid') return item.price >= 50 && item.price <= 100;
                    if (activeFilters.price === 'high') return item.price > 100;
                    return true;
                });
            }
            if (activeFilters.sort !== 'default') {
                items = [...items].sort((a, b) => activeFilters.sort === 'asc' ? a.price - b.price : b.price - a.price);
            }

            if (items.length === 0) {
                grid.innerHTML = '';
                empty.classList.remove('hidden');
                empty.classList.add('flex');
                return;
            }

            empty.classList.add('hidden');
            empty.classList.remove('flex');

            grid.innerHTML = items.map((item, index) => {
                const loadingStrategy = index < 6 ? 'eager' : 'lazy';
                return `
                <div class="bg-surface-white rounded-[1.25rem] p-4 border border-border-light shadow-card hover:shadow-float hover:border-brand-primary/20 transition-all duration-300 group flex flex-col h-full relative">
                    <div class="relative h-48 rounded-[1rem] overflow-hidden mb-4 bg-surface-input">
                        <div class="skeleton animate-pulse"></div>
                        <img src="${item.img}" 
                             alt="${item.name}" 
                             loading="${loadingStrategy}"
                             class="object-cover w-full h-full relative z-10 img-fade-in transform group-hover:scale-105 transition-transform duration-500"
                             onload="this.parentElement.querySelector('.skeleton').style.display='none'; this.classList.add('img-loaded');"
                        >
                        <div class="absolute top-3 right-3 bg-white p-1.5 rounded-lg shadow-sm z-20">
                            <div class="border border-status-success w-3.5 h-3.5 flex items-center justify-center rounded-[2px]">
                                <div class="bg-status-success w-2 h-2 rounded-full"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex-grow flex flex-col justify-between">
                        <div>
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-display text-[1.25rem] text-text-main tracking-tight leading-6 w-full pr-2">${item.name}</h3>
                            </div>
                            <p class="font-body font-bold text-xs text-text-light uppercase tracking-wider mb-4">${item.cat.replace(/_/g, ' ')}</p>
                        </div>
                        
                        <div class="flex items-center justify-between mt-auto pt-2 border-t border-border-light/50">
                            <span class="bg-brand-tint text-brand-primary px-3 py-1 rounded-lg font-bold text-lg">₹${item.price}</span>
                            <div id="btn-container-${item.id}">
                                ${getCardActionHTML(item)}
                            </div>
                        </div>
                    </div>
                </div>
            `}).join('');
            
            updateFilterIndicator();
        }

        function updateItemCardUI(itemId) {
            const container = document.getElementById(`btn-container-${itemId}`);
            if (container) {
                const item = MENU_ITEMS.find(i => i.id === itemId);
                container.innerHTML = getCardActionHTML(item);
            }
        }

        // --- FILTER ---
        function toggleFilterModal() {
            const modal = document.getElementById('filter-modal');
            const backdrop = document.getElementById('filter-backdrop');
            const content = document.getElementById('filter-content');

            if (modal.classList.contains('hidden')) {
                pendingFilters = { ...activeFilters };
                syncFilterUI();
                modal.classList.remove('hidden');
                void modal.offsetWidth;
                backdrop.classList.remove('opacity-0');
                content.classList.remove('translate-y-full', 'md:translate-y-10');
            } else {
                backdrop.classList.add('opacity-0');
                content.classList.add('translate-y-full', 'md:translate-y-10');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
        }

        function updatePendingFilter(type, value) {
            pendingFilters[type] = value;
            syncFilterUI();
        }

        function syncFilterUI() {
            document.getElementById('filter-veg').checked = pendingFilters.veg;
            ['all', 'low', 'mid', 'high'].forEach(val => {
                const btn = document.getElementById(`btn-price-${val}`);
                btn.className = pendingFilters.price === val 
                    ? "filter-chip px-4 py-2 rounded-full bg-brand-primary text-white shadow-brand text-sm font-bold transition-all"
                    : "filter-chip px-4 py-2 rounded-full bg-surface-input text-text-muted hover:bg-border-light text-sm font-bold transition-all";
            });
            ['default', 'asc', 'desc'].forEach(val => {
                const btn = document.getElementById(`btn-sort-${val}`);
                btn.className = pendingFilters.sort === val 
                    ? "filter-chip px-4 py-2 rounded-full bg-text-main text-white shadow-soft text-sm font-bold transition-all"
                    : "filter-chip px-4 py-2 rounded-full bg-surface-input text-text-muted hover:bg-border-light text-sm font-bold transition-all";
            });
        }

        function applyFilters() {
            activeFilters = { ...pendingFilters };
            renderMenu();
            toggleFilterModal();
        }

        function clearFilters() {
            pendingFilters = { veg: false, price: 'all', sort: 'default' };
            activeFilters = { ...pendingFilters };
            renderMenu();
            toggleFilterModal();
        }

        function clearSearchAndFilters() {
            document.getElementById('search-input').value = '';
            searchQuery = '';
            activeFilters = { veg: false, price: 'all', sort: 'default' };
            renderCategories();
            renderMenu();
        }

        function updateFilterIndicator() {
            const indicator = document.getElementById('filter-indicator');
            const isActive = activeFilters.veg || activeFilters.price !== 'all' || activeFilters.sort !== 'default';
            if (isActive) indicator.classList.remove('hidden');
            else indicator.classList.add('hidden');
        }

        // --- CORE LOGIC ---
        function setCategory(id) {
            currentCat = id;
            searchQuery = '';
            document.getElementById('search-input').value = '';
            renderCategories();
            renderMenu();
        }

        function handleSearch(val) {
            searchQuery = val.trim();
            renderMenu();
        }

        let pendingItem = null;
        function triggerAdd(itemId) {
            if (!currentMode) {
                pendingItem = itemId;
                document.getElementById('mode-selector').classList.remove('hidden');
                return;
            }
            updateCart(itemId, 1);
        }

        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('mode-selector').classList.add('hidden');
            if (pendingItem) {
                updateCart(pendingItem, 1);
                pendingItem = null;
            }
        }

        function updateCart(itemId, delta) {
            if (!cart[itemId]) cart[itemId] = {};
            if (!cart[itemId][currentMode]) cart[itemId][currentMode] = 0;
            cart[itemId][currentMode] += delta;

            if (cart[itemId][currentMode] <= 0) delete cart[itemId][currentMode];
            if (Object.keys(cart[itemId]).length === 0) delete cart[itemId];
            if (Object.keys(cart).length === 0) currentMode = null;

            updateItemCardUI(itemId); 
            updateCartBar();
            renderCartModalItems();
        }

        function getQuantity(itemId) {
            if (!cart[itemId]) return 0;
            return Object.values(cart[itemId]).reduce((a, b) => a + b, 0);
        }

        function updateCartBar() {
            let totalItems = 0;
            let totalPrice = 0;

            Object.keys(cart).forEach(id => {
                const item = MENU_ITEMS.find(i => i.id === id);
                Object.values(cart[id]).forEach(qty => {
                    totalItems += qty;
                    totalPrice += (item.price * qty);
                });
            });

            const bar = document.getElementById('cart-bar');
            if (totalItems > 0) {
                bar.classList.remove('translate-y-[150%]');
                document.getElementById('cart-bar-total').innerText = `₹${totalPrice}`;
            } else {
                bar.classList.add('translate-y-[150%]');
            }
            return totalPrice;
        }

        function toggleCartModal() {
            const modal = document.getElementById('cart-modal');
            const backdrop = document.getElementById('cart-backdrop');
            const content = document.getElementById('cart-content');
            
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                void modal.offsetWidth;
                backdrop.classList.remove('opacity-0');
                content.classList.remove('translate-y-full', 'md:translate-y-10');
                renderCartModalItems();
            } else {
                backdrop.classList.add('opacity-0');
                content.classList.add('translate-y-full', 'md:translate-y-10');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
        }

        function renderCartModalItems() {
            const container = document.getElementById('cart-items-container');
            const itemIds = Object.keys(cart);
            let subtotal = 0;
            let hasDeliveryItems = false;
            let hasPickupItems = false;

            if (itemIds.length === 0) {
                container.innerHTML = `<div class="flex flex-col items-center justify-center py-12 text-text-light/50">
                    <span class="material-symbols-outlined text-5xl mb-3">shopping_cart</span>
                    <span class="font-bold text-sm">Your cart is empty</span>
                </div>`;
                updateFooterTotals(0, false);
                const subtitle = document.getElementById('cart-mode-subtitle');
                if(subtitle) subtitle.classList.add('hidden');
                return;
            }

            const subtitle = document.getElementById('cart-mode-subtitle');
            const icon = document.getElementById('cart-mode-icon');
            const text = document.getElementById('cart-mode-text');
            
            if (subtitle && currentMode) {
                subtitle.classList.remove('hidden');
                text.innerText = currentMode + ' Order';
                icon.innerText = modeConfig[currentMode].icon;
            }

            let html = '<div class="space-y-6">';

            html += '<div class="space-y-5">';
            itemIds.forEach(id => {
                const item = MENU_ITEMS.find(i => i.id === id);
                const modes = cart[id]; 

                Object.entries(modes).forEach(([mode, qty]) => {
                    const lineTotal = item.price * qty;
                    subtotal += lineTotal;
                    if(mode === 'Delivery') hasDeliveryItems = true;
                    if(mode === 'Pickup') hasPickupItems = true;

                    html += `
                        <div class="flex items-start gap-4">
                            <div class="w-16 h-16 rounded-xl bg-surface-input overflow-hidden shrink-0 border border-border-light">
                                <img src="${item.img}" class="w-full h-full object-cover">
                            </div>
                            <div class="flex-grow pt-0.5">
                                <div class="flex justify-between items-start mb-1">
                                    <h4 class="font-display text-lg text-text-main leading-tight">${item.name}</h4>
                                    <span class="font-body font-black text-text-main">₹${lineTotal}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs font-bold text-text-muted">₹${item.price} x ${qty}</span>
                                    <div class="flex items-center gap-3 bg-surface-input rounded-full px-2 py-1 h-7">
                                        <button onclick="changeModeQty('${id}', '${mode}', -1)" class="text-text-muted hover:text-brand-primary font-bold w-5 flex justify-center">-</button>
                                        <span class="text-xs font-black text-text-main w-3 text-center">${qty}</span>
                                        <button onclick="changeModeQty('${id}', '${mode}', 1)" class="text-brand-primary font-bold w-5 flex justify-center">+</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
            });
            html += '</div>';

            html += `
                <div class="mt-6 bg-surface-input rounded-2xl p-5">
                    <!-- Added Note about Packaging -->
                    <p class="text-[11px] text-text-muted mb-3 italic">* Minimum packaging price for Kabab Paratha Plate is ₹45.</p>
                    
                    <div class="flex justify-between items-center text-sm mb-2">
                        <span class="text-text-muted font-bold">Item Total</span>
                        <span class="text-text-main font-black">₹${subtotal}</span>
                    </div>
                    ${hasDeliveryItems ? `
                    <div class="flex justify-between items-center text-sm">
                        <span class="text-text-muted font-bold">Delivery Fee</span>
                        <span class="font-black text-status-success">FREE</span>
                    </div>` : ''}
                    <div class="mt-3 pt-3 border-t border-border-light">
                        <p class="text-[10px] text-text-tertiary font-bold text-center uppercase tracking-widest">
                            Inclusive of all taxes
                        </p>
                    </div>
                </div>
            `;
            html += '</div>';
            container.innerHTML = html;
            
            let formMode = 'Dine-in';
            if (hasDeliveryItems) formMode = 'Delivery';
            else if (hasPickupItems) formMode = 'Pickup';
            
            updateFooterTotals(subtotal, formMode);
        }

        function updateFooterTotals(grandTotal, mode) {
            document.getElementById('modal-total').innerText = `₹${grandTotal}`;
            const addressContainer = document.getElementById('address-container');
            const phoneContainer = document.getElementById('phone-container');

            addressContainer.classList.add('hidden');
            phoneContainer.classList.add('hidden');
            
            if (mode === 'Delivery') {
                addressContainer.classList.remove('hidden');
                phoneContainer.classList.remove('hidden');
            } else if (mode === 'Pickup') {
                phoneContainer.classList.remove('hidden');
            } 
        }

        function changeModeQty(id, mode, delta) {
            cart[id][mode] += delta;
            if (cart[id][mode] <= 0) delete cart[id][mode];
            if (Object.keys(cart[id]).length === 0) delete cart[id];
            updateCartBar();
            updateItemCardUI(id);
            renderCartModalItems();
        }

        function placeOrder() {
            const name = document.getElementById('cust-name').value.trim();
            const phone = document.getElementById('cust-phone').value.trim();
            const address = document.getElementById('cust-address').value.trim();

            let hasDelivery = false, hasPickup = false;
            Object.keys(cart).forEach(id => {
                Object.entries(cart[id]).forEach(([mode, qty]) => {
                    if(mode === 'Delivery') hasDelivery = true;
                    if(mode === 'Pickup') hasPickup = true;
                });
            });

            let mode = 'Dine-in';
            if (hasDelivery) mode = 'Delivery';
            else if (hasPickup) mode = 'Pickup';

            if (!name) { alert("Please enter your Name"); return; }
            if (mode === 'Delivery') {
                if (!phone || phone.length !== 10) { alert("Valid 10-digit Phone Required"); return; }
                if (!address) { alert("Delivery Address Required"); return; }
            } else if (mode === 'Pickup') {
                if (phone && phone.length !== 10) { alert("Valid 10-digit Phone Required"); return; }
            }

            let msg = `*New Order: Lucknow Wala*\n`;
            msg += `Customer: ${name}\n`;
            if (phone) msg += `Phone: +91 ${phone}\n`;
            if (address) msg += `Address: ${address}\n`;
            msg += `------------------------\n`;

            let grandTotal = 0;
            Object.keys(cart).forEach(id => {
                const item = MENU_ITEMS.find(i => i.id === id);
                Object.entries(cart[id]).forEach(([mode, qty]) => {
                    const total = item.price * qty;
                    grandTotal += total;
                    msg += `${qty}x ${item.name} (${mode}) - ₹${total}\n`;
                });
            });

            msg += `------------------------\n`;
            msg += `*Total: ₹${grandTotal}*\n`;
            if (hasDelivery) msg += `Delivery: FREE\n`;
            
            window.open(`https://wa.me/919910959641?text=${encodeURIComponent(msg)}`, '_blank');
        }
    </script>
</body>
</html>
